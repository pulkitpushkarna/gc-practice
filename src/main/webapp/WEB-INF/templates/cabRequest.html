<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mainLayout}">
    <head>


    </head>
    <body>
    <div class="row" layout:fragment="content">
        <table>
            <tr>
                <td>Request Type</td>
                <td>
                    <select id="cabRequestType" name="cabRequestType" >
                        <option th:each="cabRequestType : ${cabRequestTypes}"
                            th:value="${cabRequestType}" th:text="${cabRequestType.getName()}"
                                th:selected="${cabRequestType.name.equals('Permanent')}">
                        </option>
                    </select>
                </td>
            </tr>
            <tr id="date-td" hidden>
                <td>Select the Date</td>
                <td><input type="text" id="pickUpDate"></td>
            </tr>
            <tr id="route-td">
            <td>Route</td>
            <td>
                <select id="route" name="route" >
                    <option th:each="route : ${routeList}"
                            th:value="${route.id}" th:text="${route.name}">
                    </option>
                </select>
            </td>
            </tr>
            <tr id="drop-location-td" hidden>
                <td>Drop Location</td>
                <td><input type="text" id="dropLocation">  </td>
            </tr>
            <tr id="pickup-location-td" hidden>
                <td>Pickup Location</td>
                <td><input type="text" id="pickUpLocation"></td>
            </tr>
            <tr>
                <td>Project Name</td>
                <td><input type="text" id="projectName"></td>
            </tr>
            <tr>
                <td>Project Manager</td>
                <td><input type="text" id="projectManager"></td>
            </tr>
            <tr>
                <td><input type="button" value="Submit" id="submit"></td>
            </tr>
        </table>

        <table>
            <tr th:each="cabRequest : ${cabRequestList}">
                <td th:text="${cabRequest.dropLocation}"> </td>
                <td th:text="${cabRequest.projectName}"> </td>
                <td th:text="${cabRequest.dropLocation}"> </td>
                <td th:text="${cabRequest.managerEmail}"> </td>
                <td th:text="${cabRequest.cabRequestStatus}"></td>
                <td><input th:id="${cabRequest.id}" type="button" name="cancelCabRequest" value="Cancel"/></td>

            </tr>
        </table>
    </div>
    <th:block layout:fragment="post-common-scripts">
        <script>
            $( function() {
                $( "#pickUpDate" ).datetimepicker();

                jQuery("#cabRequestType").change(function(){
                   console.log("<<<<<jQuery(this).val()>>>>>"+jQuery(this).val());
                   var cabRequest = jQuery(this).val();
                   if(cabRequest==="PERMANENT"){
                        jQuery("#route-td").show();
                        jQuery("#date-td").hide();
                        jQuery("#drop-location-td").hide();
                        jQuery("#pickup-location-td").hide();
                   }else{
                        jQuery("#route-td").hide();
                        jQuery("#date-td").show();
                        jQuery("#drop-location-td").show();
                        jQuery("#pickup-location-td").show();
                   }
                });

                jQuery("input[name='cancelCabRequest']").click(function(){
                    var cabRequestId = jQuery(this).attr("id");
                    jQuery.ajax({
                        url:"/cancelCabRequest",
                        data:{
                            cabRequestId: cabRequestId
                        },
                        success:function(data){
                            alert(data)
                        }
                    });
                });

                jQuery("#submit").click(function(){
                    var pickUpDate = jQuery("#pickUpDate").val();
                    var dropLocation = jQuery("#dropLocation").val();
                    var projectName = jQuery("#projectName").val();
                    var projectManager = jQuery("#projectManager").val();
                    var cabRequestType = jQuery("#cabRequestType").val();
                    var pickUpLocation = jQuery("#pickUpLocation").val();

                    jQuery.ajax({
                        url:"/cabRequestSubmission",
                        data:{
                            pickUpDate: pickUpDate,
                            dropLocation: dropLocation,
                            projectName: projectName,
                            projectManager: projectManager,
                            cabRequestType: cabRequestType,
                            pickUpLocation: pickUpLocation
                        },
                        success:function(data){
                            jQuery("#pickUpDate").val("");
                            jQuery("#dropLocation").val("");
                            jQuery("#projectName").val("");
                            jQuery("#cabRequestType").val("");
                            jQuery("#pickUpDate").val("");
                            jQuery("#projectManager").val("");
                            jQuery("#pickUpLocation").val("");
                            alert("Request submitted successfully!!");
                        }
                    });
                });
            } );
        </script>
    </th:block>
    </body>
</html>