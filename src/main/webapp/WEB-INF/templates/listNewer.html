<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mainLayout}">
<head>
    <title>Newer List</title>
</head>
<body>
<div class="row" layout:fragment="content">
    <table class="table table-border">
        <tr class="row">
            <th class="col-md-3">EmpId</th>
            <th class="col-md-3">Name</th>
            <th class="col-md-3">email</th>
            <th class="col-md-3">Role</th>
        </tr>
        <tr class="row" th:each="newer : ${newers}">
            <td class="col-md-3" th:text="${newer.newerId}"></td>
            <td class="col-md-3" th:text="${newer.firstName+ ' ' +newer.lastName}"></td>
            <td class="col-md-3" th:text="${newer.email}"></td>
            <td class="col-md-3">
                <select th:id="${'selected-role-'+newer.newerId}" th:attr="data-id=${newer.newerId}" name="role">
                    <option th:text="${newer.userRole.name}"></option>
                    <option th:each="role : ${T(com.springmvc.enums.UserRole).listRolesExcept(newer.userRole)}" th:value="${role}" th:text="${role.getName()}"></option>
                </select>
            </td>
        </tr>
    </table>
</div>

<th:block layout:fragment="post-common-scripts">
    <script th:inline="javascript">
        /*<![CDATA[*/
        jQuery("[id^=selected-role-]").on("change", function () {
            var selectedRole = $(this).find(":selected").val();
            var newerId = $(this).data("id");
            var baseUrl = /*[[@{/admin/updateRole}]]*/ '';
            console.log(baseUrl);
            var finalUrl = baseUrl + "/" + newerId;
            makePutCall(finalUrl, {role: selectedRole}, function (data) {
                console.log("Is Role Changed???? ", data);
            })
        });
        /*]]>*/
    </script>
</th:block>
</body>
</html>